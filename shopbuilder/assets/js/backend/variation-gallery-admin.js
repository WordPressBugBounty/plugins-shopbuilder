!function(t){"use strict";var e=function(){t(".woocommerce_variation").each(function(){var e=t(this).find(".options");t(this).find(".rtsb-vg-gallery-wrapper").insertBefore(e)})},i=function(){t(".rtsb-vg-images").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"rtsb-vg-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")},update:function(){o(this)}})},o=function(e){t(e).closest(".woocommerce_variation").addClass("variation-needs-update"),t("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),t("#variable_product_options").trigger("woocommerce_variations_input_changed")},a=function(e){e.preventDefault(),e.stopPropagation();var a=t(e.currentTarget),n=0,r=a.data("product_variation_id"),d=a.data("product_variation_loop"),l=a.parents(".rtsb-vg-gallery-wrapper").find("input").map(function(){return Number(t(this).val())}).get();if("undefined"!=typeof wp&&wp.media&&wp.media.editor){if(n)return void n.open();(n=wp.media.frames.select_image=wp.media({title:rtsbVgParams.choose_image,button:{text:rtsbVgParams.add_image},library:{type:["image"]},multiple:!0})).on("select",function(){var t=n.state().get("selection").toJSON().map(function(t){if("image"===t.type){if(console.log(t),-1===l.indexOf(t.id)){var e=t.id,i=t.rtsb_vg_video_link,o=t.sizes,a=(o=void 0===o?{}:o).thumbnail,n=o.full,s=a?a.url:n.url;return wp.template("rtsb-vg-image")({id:e,url:s,product_variation_id:r,loop:d,rtsb_vg_video_link:i})}alert("Cannot add duplicate items.")}}).join("");console.log(t),a.parent().prev().find(".rtsb-vg-images").append(t),i(),o(a)}),n.open()}};function n(e){var i;e.preventDefault(),e.stopPropagation();var o=t(e.currentTarget).parents("li.image"),a=o.find("input").val();if(a){var n=wp.media.attachment(a),r=(null===(i=rtsbVgParams)||void 0===i?void 0:i.pro_version)||null,d="2.1.3",l=r&&function(t,e){for(var i=t.split(".").map(Number),o=e.split(".").map(Number),a=0;a<Math.max(i.length,o.length);a++){var n=i[a]||0,r=o[a]||0;if(n>r)return!0;if(n<r)return!1}return!0}(r,d);n.fetch().done(function(){var e=n.toJSON(),i=(null==e?void 0:e.rtsb_vg_video_link)||"",r=(null==e?void 0:e.rtsb_vg_video_width)||"",s=(null==e?void 0:e.rtsb_vg_video_height)||"",c='\n            <div class="custom-edit-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999999; display: flex; align-items: center; justify-content: center;">\n                <div class="modal-inner-wrapper" style="background: white; padding: 30px; border-radius: 8px; max-width: 400px; width: 90%;">\n                    <div class="modal-form-section" >\n                        <h2 style="margin-top:0">Poster Image</h2>\n                        <hr/>\n                        <div class="image-wrap" style="display: flex;justify-content: center;"><img src="'.concat(e.url,'" style="max-width: 250px; height: auto; margin-bottom: 20px;"></div>\n                        ').concat(l?"":'\n                        <div style="background: #fef7e0; border: 1px solid #e0c97d; color: #7a6000; padding: 10px 15px; border-radius: 6px; margin-bottom: 15px;">\n                            Video options are available in the <a href="https://www.radiustheme.com/downloads/woocommerce-variation-images-gallery/" style="color: red;font-size: 16px" target="_blank"><strong>Pro version</strong></a> <br/> (minimum version '.concat(d,")\n                        </div>\n                        "),'\n                        <label style="display: block; margin-bottom: 15px;">\n                            <strong>Video Url: </strong>\n                            <input ').concat(l?"":"disabled",' type="text" id="rtsb_vg_video_link" value="').concat(i,'" placeholder="https://www.youtube.com/watch?v=zQKKUx2ECa8" style="width: 100%; padding: 8px; margin-top: 5px;">\n                            <p class="help">You can add a YouTube, Vimeo, TikTok, or uploaded video. <b>Example: https://www.youtube.com/watch?v=zQKKUx2ECa8</b> <br/> <a href="').concat(rtsbVgParams.admin_url,'upload.php?mode=grid&attachment-filter=post_mime_type%3Avideo" target="_blank">Upload your video <span class="dashicons dashicons-video-alt3"></span></a></p>\n                        </label>\n                        <label style="display: block; margin-bottom: 15px;">\n                            <strong>Video Width: </strong>\n                            <input ').concat(l?"":"disabled",' type="text" id="rtsb_vg_video_width" value="').concat(r,'" style="width: 100%; padding: 8px; margin-top: 5px;">\n                            <p class="help">Video Width. px or %. Empty for default. <b>Example: 575px</b> </p>\n                        </label>\n                        <label style="display: block; margin-bottom: 15px;">\n                            <strong>Video Height: </strong>\n                            <input ').concat(l?"":"disabled",' type="text" id="rtsb_vg_video_height" value="').concat(s,'" style="width: 100%; padding: 8px; margin-top: 5px;">\n                            <p class="help">Video Height. px or %. Empty for default. <b>Example: 550px</b></p>\n                        </label>\n                    </div>\n                     <hr/>\n                    <div style="text-align: right;margin-top:15px">\n                        <button class="button" id="cancel-edit" style="margin-right: 10px;">Cancel</button>\n                        <button class="button button-primary" id="save-edit">Update</button>\n                    </div>\n                </div>\n            </div>');t("body").append(c),t("#cancel-edit").on("click",function(){t(".custom-edit-modal").remove()}),t("#save-edit").on("click",function(){var e,i=t("body").find("#rtsb_vg_video_link"),n=t("body").find("#rtsb_vg_video_width"),r=t("body").find("#rtsb_vg_video_height");i.length&&n.length&&r.length?null!==(e=rtsbVgParams)&&void 0!==e&&e.pro_version?t.ajax({url:ajaxurl,type:"POST",data:{action:"rtsb_vg_update_attachment_video_meta",attachment_id:a,video_link:i.val(),video_width:n.val(),video_height:r.val(),_wpnonce:rtsbVgParams.nonce||""},success:function(e){var i,a,n;null!=e&&null!==(i=e.data)&&void 0!==i&&i.hasVideo?o.addClass("video"):o.removeClass("video"),t("body").find(".modal-inner-wrapper").html(null==e||null===(a=e.data)||void 0===a?void 0:a.message),null!=e&&e.success&&setTimeout(function(){t("body").find(".custom-edit-modal").remove()},800),console.log(null==e||null===(n=e.data)||void 0===n?void 0:n.message)}}):alert("It's Pro Feature"):alert("Required video fields are missing. Please reload the page.")})}).fail(function(){console.error("Failed to load attachment")})}}var r=function(e){e.preventDefault(),e.stopPropagation();var i=t(e.currentTarget);o(i),setTimeout(function(){t(i).parents("li.image").remove()},1)};function d(e){e.preventDefault(),e.stopPropagation();var i=t(e.currentTarget).parents("li.image"),a=i.find("input"),n=a.val(),r=wp.media({title:"Edit Image",button:{text:"Update Image"},library:{type:"image"},multiple:!1});r.on("open",function(){if(n){var t=r.state().get("selection"),e=wp.media.attachment(n);e.fetch(),t.add(e)}}),r.on("select",function(){var t,e=r.state().get("selection").first().toJSON(),o=(null===(t=e.sizes)||void 0===t||null===(t=t.thumbnail)||void 0===t?void 0:t.url)||e.url,n=i.find("img");null!=e&&e.rtsb_vg_video_link?i.addClass("video"):i.removeClass("video"),n.length&&n.attr("src",o),a.val(e.id)}),r.open(),o(this)}t(document).off("click",".rtsb-vg-add-image"),t(document).on("click",".rtsb-vg-add-image",a),t(document).on("click",".rtsb-vg-remove-image",r),t(document).on("click",".rtsb-vg-gallery-edit",d),t(document).on("click",".rtsb-vg-media-video-popup",n),t("#woocommerce-product-images .add_product_images").on("click","a",function(t){}),t("#woocommerce-product-data").on("woocommerce_variations_loaded",function(){e(),i()}),t("#variable_product_options").on("woocommerce_variations_added",function(){e(),i()})}(jQuery);