!function(e){"use strict";var t=function(){e(".woocommerce_variation").each(function(){var t=e(this).find(".options");e(this).find(".rtsb-vg-gallery-wrapper").insertBefore(t)})},o=function(){e(".rtsb-vg-images").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"rtsb-vg-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){i(this)}})},i=function(t){e(t).closest(".woocommerce_variation").addClass("variation-needs-update"),e("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),e("#variable_product_options").trigger("woocommerce_variations_input_changed")},a=function(t){t.preventDefault(),t.stopPropagation();var a=e(t.currentTarget),r=0,n=a.data("product_variation_id"),c=a.data("product_variation_loop"),d=a.parents(".rtsb-vg-gallery-wrapper").find("input").map(function(){return Number(e(this).val())}).get();if("undefined"!=typeof wp&&wp.media&&wp.media.editor){if(r)return void r.open();(r=wp.media.frames.select_image=wp.media({title:rtsbVgParams.choose_image,button:{text:rtsbVgParams.add_image},library:{type:["image"]},multiple:!0})).on("select",function(){var e=r.state().get("selection").toJSON().map(function(e){if("image"===e.type){if(console.log(e),-1===d.indexOf(e.id)){var t=e.id,o=e.rtsb_vg_video_link,i=e.sizes,a=(i=void 0===i?{}:i).thumbnail,r=i.full,s=a?a.url:r.url;return wp.template("rtsb-vg-image")({id:t,url:s,product_variation_id:n,loop:c,rtsb_vg_video_link:o})}alert("Cannot add duplicate items.")}}).join("");console.log(e),a.parent().prev().find(".rtsb-vg-images").append(e),o(),i(a)}),r.open()}},r=function(t){t.preventDefault(),t.stopPropagation();var o=e(t.currentTarget),i=0;if("undefined"!=typeof wp&&wp.media&&wp.media.editor){if(i)return void i.open();(i=wp.media.frames.select_image=wp.media({title:rtsbVgParams.choose_video,button:{text:rtsbVgParams.add_video},library:{type:["video"]},multiple:!1})).on("select",function(){var t=i.state().get("selection").first().toJSON();"video"===t.type&&e(o).closest(".compat-attachment-fields").find(".compat-field-rtsb_vg_video_link input").val(t.url).change()}),i.open()}},n=function(t){t.preventDefault(),t.stopPropagation();var o=e(t.currentTarget);i(o),setTimeout(function(){e(o).parent().remove()},1)};e(document).off("click",".rtsb-vg-add-image"),e(document).on("click",".rtsb-vg-add-image",a),e(document).on("click",".rtsb-vg-remove-image",n),e(document).on("click",".rtsb-vg-media-video-popup",r),e("#woocommerce-product-images .add_product_images").on("click","a",function(t){e(document).on("click",".rtsb-vg-media-video-popup",r)}),e("#woocommerce-product-data").on("woocommerce_variations_loaded",function(){t(),o()}),e("#variable_product_options").on("woocommerce_variations_added",function(){t(),o()})}(jQuery);