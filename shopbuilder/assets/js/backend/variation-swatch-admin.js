!function(t){"use strict";jQuery(document).ajaxComplete(function(s,r,e){if(r&&4===r.readyState&&200===r.status&&e.data&&0<=e.data.indexOf("action=add-tag")){var o=wpAjax.parseAjaxResponse(r.responseXML,"ajax-response");if(!o||o.errors)return;return t.fn.wpColorPicker&&t("input.rtsb-vs-color-picker").wpColorPicker(),void t("button.rtsb-vs-remove-image").trigger("click")}});var s=function(){var s=t("#rtsb_vs_attribute_tooltip").val();"text"===s?(t(".rtsb_vs_attribute_tooltip_text").show(),t(".rtsb_vs_attribute_tooltip_image").hide()):"image"===s?(t(".rtsb_vs_attribute_tooltip_text").hide(),t(".rtsb_vs_attribute_tooltip_image").show()):t(".rtsb_vs_attribute_tooltip_text, .rtsb_vs_attribute_tooltip_image").hide()},r=function(){t("#rtsb_vs_is_dual_color").is(":checked")?t(".rtsb_vs_secondary_color").show():t(".rtsb_vs_secondary_color").hide()},e=function(){t.fn.wpColorPicker&&t("input.rtsb-vs-color-picker").wpColorPicker(),t("#rtsb_vs_attribute_tooltip").on("change",function(){s()}),t("#rtsb_vs_is_dual_color").on("change",function(){r()}),t(document.body).on("click",".rtsb-vs-reset-attributes",function(){if(confirm(rtsbVsParams.reset_notice)){t("#rtsb_vs_tab_options").block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var s={post_id:rtsbVsParams.post_id,__rtsb_wpnonce:rtsbVsParams.__rtsb_wpnonce,action:"rtsb_vs_reset_attributes"};t.ajax({type:"POST",url:rtsbVsParams.ajaxurl,data:s,beforeSend:function(){t("#rtsb_vs_tab_options").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(s){t("#rtsb_vs_tab_options").html(s.data.html),t(document).trigger("rtsb_variations_initialized"),t("#rtsb_vs_tab_options").unblock()},error:function(s,r){t("#rtsb_vs_tab_options").unblock(),console.error("Uncaught Error:"+s.responseText)}})}}),t(document.body).on("click",".rtsb-vs-save-attributes",function(){t.ajax({type:"POST",url:rtsbVsParams.ajaxurl,data:{post_id:rtsbVsParams.post_id,__rtsb_wpnonce:rtsbVsParams.__rtsb_wpnonce,action:"rtsb_vs_save_attributes",data:t(".rtsb-vs-tab-options").find("input, select, textarea").serialize()},beforeSend:function(){t("#rtsb_vs_tab_options").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(s){t("#rtsb_vs_tab_options").unblock()},error:function(s,r){t("#rtsb_vs_tab_options").unblock(),console.error("Uncaught Error:"+s.responseText)}})}),t(".rtsb-vs-attribute-term-is-dual-color input").each(function(){var s=t(this),r=s.closest(".rtsb-vs-metabox-content-wrap").find(".rtsb-vs-attribute-term-secondary-color"),e=function(){s.is(":checked")?r.addClass("rtsb_vs_visible_if_dual_color_yes"):r.removeClass("rtsb_vs_visible_if_dual_color_yes")};s.on("change",e),e()}),t(".rtsb-vs-attribute-term-type").each(function(){var s=this,r=t(this).closest(".rtsb-vs-attribute-term-box-wrapper"),e=t(this).closest(".rtsb-vs-attribute-box-wrapper"),o=function(){var e=t(s).val(),o="rtsb_vs_visible_if_term_"+e,i=Object.keys(rtsbVsParams.attribute_types).map(function(t){return"rtsb_vs_visible_if_term_"+t}).join(" ");return i+=" rtsb_vs_visible_if_custom",r.removeClass(i).addClass(o),e};t(this).on("change",function(){o();var s=e.find(".rtsb-vs-attribute-term-type").map(function(){return t(this).val()}).get(),r=_.uniq(s),i=1===r.length?r[0]:"custom";e.find(".rtsb-vs-attribute-type").val(i).trigger("change.attribute")}),t(this).on("change.term",function(){o()}),o()}),t(".rtsb-vs-attribute-term-tooltip select").each(function(){var s=this,r=t(this).closest(".rtsb-vs-metabox-content-wrap"),e=function(){var e=t(s).val(),o="rtsb_vs_visible_if_tooltip_"+e,i=["text","image"].map(function(t){return"rtsb_vs_visible_if_tooltip_"+t}).join(" ");return r.removeClass(i).addClass(o),e};t(this).on("change.attribute",function(){e()}),e()}),t(".rtsb-vs-attribute-type").each(function(){var s=this,r=t(this).closest(".rtsb-vs-attribute-box-wrapper"),e=function(){var e=t(s).val(),o="rtsb_vs_visible_if_"+e,i=Object.keys(rtsbVsParams.attribute_types).map(function(t){return"rtsb_vs_visible_if_"+t}).join(" ");return r.removeClass(i).addClass(o),e};t(this).on("change",function(){var s=e();if(s)r.find(".rtsb-vs-attribute-term-type").val(s).trigger("change.term");else{var o=t(".rtsb-vs-attribute-term-type").find("option[selected]").val();r.find(".rtsb-vs-attribute-term-type").val(o).trigger("change.term")}}),t(this).on("change.attribute",function(){e()}),e()}),t(".rtsb-vs-metaboxes-wrapper").on("click",".rtsb-vs-metabox > h3",function(){t(this).parent(".rtsb-vs-metabox").toggleClass("closed").toggleClass("open")}).on("click",".rtsb-vs-metabox h3",function(s){t(s.target).filter(":input, option, .sort").length||t(this).next(".rtsb-vs-metabox-content").stop().slideToggle()}),t(".rtsb-vs-metabox.closed").each(function(){t(this).find(".rtsb-vs-metabox-content").hide()}),t(document).on("click","button.rtsb-vs-upload-image",function(s){var r;s.stopPropagation();var e=t(this);if("undefined"!=typeof wp&&wp.media&&wp.media.editor){if(r)return void r.open();(r=wp.media.frames.select_image=wp.media({title:rtsbVsParams.media_title,button:{text:rtsbVsParams.button_title},multiple:!1})).on("select",function(){var s=r.state().get("selection").first().toJSON();if(""!==t.trim(s.id)){var o=void 0===s.sizes.thumbnail?s.sizes.full.url:s.sizes.thumbnail.url;e.prev().val(s.id),e.closest(".rtsb-image-wrapper").find("img").attr("src",o),e.next().show()}}),r.on("open",function(){var t=r.state().get("selection"),s=e.prev().val(),o=wp.media.attachment(s);o.fetch(),t.add(o?[o]:[])}),r.open()}}),t(document).on("click","button.rtsb-vs-remove-image",function(s){s.preventDefault(),s.stopPropagation();var r=t(this),e=r.closest(".rtsb-image-wrapper").find("img").data("placeholder");return r.closest(".rtsb-image-wrapper").find("img").attr("src",e),r.prev().prev().val(""),r.hide(),!1}),s(),r()};e(),t(document.body).off("click.rtsb_tab_options",".rtsb-vs-tab_options").on("click.rtsb_tab_options",".rtsb-vs-tab_options",function(){var s=t("#rtsb_vs_tab_options");console.log("Run Render Attributes Function"),s.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var r={post_id:rtsbVsParams.post_id,__rtsb_wpnonce:rtsbVsParams.__rtsb_wpnonce,action:"rtsb_vs_render_attributes"};t.ajax({type:"POST",url:rtsbVsParams.ajaxurl,data:r,success:function(r){s.html(r.data.html),t(document).trigger("rtsb_variations_initialized"),s.unblock()},error:function(t){s.unblock(),console.error("Uncaught Error:",t.responseText)}})}),t(document).on("rtsb_variations_initialized",function(){e()})}(jQuery);