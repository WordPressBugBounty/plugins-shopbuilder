(()=>{"use strict";!function(e){var r=function(){var e=(window.RTSB||{}).cache,r=(null==e?void 0:e.create("variationGallery"))||null;return{name:"variationGallery",version:"1.0.0",init:function(){return this.run(),r.set("initialized",!0),this},refresh:function(){this.run()},run:function(){i(),s()},destroy:function(){r.clear()}}},i=function(){e(document).on("wc_variation_form",".variations_form",function(e){t(e.currentTarget)})},t=function(r){var i=e(r),t=i.closest(".product"),n=!!i.length,o=t.find(".rtsb-carousel-slider"),s=t.find(".product-vg-gallery"),l=t.find(".rtsb-vs-thumb-slider"),d=t.find(".rtsb-vg-main-slider-wrapper"),g=[],c=i.data("product_id"),v=l.data("options")||{},f=parseInt((null==v?void 0:v.slidesPerView)||4,10),u=t.find(".rtsb-vg-image-grid-view"),p=s.length<1&&u.length>0,m=function(e){i.trigger("rtsb_vg_before_gallery_image_loaded");var r=e.length>1;if(p){var t=wp.template("vg-grid-view-template");u.html(t(e))}else{var a=wp.template("vg-slider-template");if(s.find(".swiper-wrapper").html(a(e)),r){s.find(".swiper-nav").removeClass("rtsb-vg-swiper-nav-hide");var n=wp.template("vg-thumbnail-template");l.find(".swiper-wrapper").html(n(e))}else l.find(".swiper-wrapper").html(""),s.find(".swiper-nav").addClass("rtsb-vg-swiper-nav-hide");r&&e.length>f?l.find(".swiper-nav").removeClass("rtsb-vg-swiper-nav-hide"):l.find(".swiper-nav").addClass("rtsb-vg-swiper-nav-hide")}i.trigger("rtsb_vg_after_gallery_image_loaded")};n&&!g.length&&wp.ajax.send("rtsb_vg_get_default_gallery_images",{data:{product_id:c},success:function(e){g=e,i.trigger("rtsb_vg_default_gallery_image_loaded")},error:function(){g=[],i.trigger("rtsb_vg_default_gallery_image_loaded")}}),i.on("click.wc-variation-form",".reset_variations",function(e){m(g)}),i.on("show_variation.rtsv_vg",function(e,r){m(r.variation_gallery_images)}),i.on("rtsb_vg_before_gallery_image_loaded",function(){d.hasClass("rtsb-content-loading")||d.addClass("rtsb-content-loading")}),i.on("rtsb_vg_after_gallery_image_loaded",function(){var e,r=o.rtsb_slider();null===(e=r.swiperSlider)||void 0===e||e.update(),r&&r.swiperSlider&&"function"==typeof r.swiperSlider.slideTo&&setTimeout(function(){r.swiperSlider.slideTo(0,0)},10),a(),setTimeout(function(){d.removeClass("rtsb-content-loading")},400)})},a=function(){var r=e(".rtsb-vg-main-slider-wrapper"),i=r.find(".rtsb-carousel-slider"),t=r.hasClass("rtsb-vg-grid-wrapper"),a=r.data("image-zoom"),n=i.length<1&&t;if(a&&e.fn.zoom){var o,s=(o=n?r.find(".rtsb-vg-grid-item"):i.find(".swiper-slide")).width(),l=e.extend({touch:!0},wc_single_product_params.zoom_options);"ontouchstart"in document.documentElement&&(l.on="click"),e(o).each(function(r,i){var t=e(i).find("img");if(!parseInt(t.data("large_image_width"))>s)return!1;e(i).trigger("zoom.destroy"),e(i).zoom(l)})}},n=function(r){e(r).find("iframe, video").each(function(){var r=e(this).prop("tagName").toLowerCase();if("iframe"===r){var i=e(this).attr("src");e(this).attr("src",i)}"video"===r&&e(this)[0].pause()})},o=function(r){var i;r.preventDefault();var t=e(".rtsb-vg-main-slider-wrapper"),a=t.find(".rtsb-carousel-slider"),o=t.hasClass("rtsb-vg-image-grid-view"),s=a.length<1&&o;if("undefined"==typeof PhotoSwipe)return!1;var l=e(".pswp")[0],d=function(){var r=e(".rtsb-vg-main-slider-wrapper"),i=[],t=r.find(".swiper-slide,.rtsb-vg-grid-item");return t.length>0&&t.each(function(r,t){var a=e(t).find("img, iframe, video"),n=void 0;switch(e(a).prop("tagName").toLowerCase()){case"img":n={src:a.attr("data-large_image"),w:a.attr("data-large_image_width"),h:a.attr("data-large_image_height"),title:a.attr("data-caption")?a.attr("data-caption"):a.attr("title")};break;case"iframe":n={html:'<iframe class="rtwpvg-lightbox-iframe" src="'+a.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'};break;case"video":n={html:'<video class="rtwpvg-lightbox-video" controls controlsList="nodownload" src="'+a.attr("src")+'" style="width: 100%; height: 100%; margin: 0;padding: 0; background-color: #000000"></video>'}}i.push(n)}),i}(),g=null===(i=a.rtsb_slider().swiperSlider)||void 0===i?void 0:i.activeIndex,c=e.extend({index:g},wc_single_product_params.photoswipe_options);if(s){var v=e(r.target).parents(".rtsb-vg-grid-item").find("img").data("src"),f=d.findIndex(function(e){return console.log(e.src,v),e.src===v});c.index=f}var u=new PhotoSwipe(l,PhotoSwipeUI_Default,d,c);u.listen("close",function(){n(l)}),u.listen("afterChange",function(){n(l)}),u.init()},s=function(){var r=e(".product").find(".rtsb-vg-main-slider-wrapper");e(document).off("click",".rtsb-vg-trigger"),e(document).on("click",".rtsb-vg-trigger",function(e){e.preventDefault(),o(e)}),setTimeout(function(){a()},10),setTimeout(function(){r&&r.removeClass("rtsb-content-loading")},400)};if(window.RTSB&&window.RTSB._initialized){var l;null===(l=RTSB.modules.register("variationGallery",r))||void 0===l||l.init()}else{var d=r();window.rtsbVariationGallery=d.run,window.rtsbVariationGallery()}}(jQuery)})();